(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{699:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"摘要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#摘要"}},[s._v("#")]),s._v(" 摘要")]),s._v(" "),a("p",[s._v("本文给出一个落地可执行的 Go + DDD 代码组织方案。包含：分层含义、推荐目录树、包命名与文件命名规范、典型代码片段（领域实体、仓储接口、应用服务、适配器/实现）、防坑注意项与代码风格建议。侧重 "),a("strong",[s._v("最小侵入、依赖倒置、包循环避免")]),s._v(" 与 "),a("strong",[s._v("Go 风格")]),s._v("（"),a("code",[s._v("gofmt")]),s._v("、小写包名、单一职责、内建 "),a("code",[s._v("internal")]),s._v(" 与 "),a("code",[s._v("pkg")]),s._v(" 约束）。")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_1-基本原则-与-go-的契合点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本原则-与-go-的契合点"}},[s._v("#")]),s._v(" 1. 基本原则（与 Go 的契合点）")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("领域优先、基础设施靠后")]),s._v("：领域模型（"),a("code",[s._v("domain")]),s._v("）不依赖任何数据库、Web、框架或第三方库。")]),s._v(" "),a("li",[a("strong",[s._v("依赖倒置")]),s._v("：高层（application / adapters）依赖领域接口（domain interfaces），具体实现注入到运行时。")]),s._v(" "),a("li",[a("strong",[s._v("包的最小化与单一职责")]),s._v("：一个包只聚焦一组职责（例如 "),a("code",[s._v("order")]),s._v(" 聚合、"),a("code",[s._v("user")]),s._v(" 聚合），避免出现“god package”。")]),s._v(" "),a("li",[a("strong",[s._v("使用 "),a("code",[s._v("internal")]),s._v(" 隔离实现细节")]),s._v("：对外暴露只放在 "),a("code",[s._v("pkg")]),s._v(" 或根导出包，其他实现放 "),a("code",[s._v("internal")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("避免循环依赖")]),s._v("：通过接口与构造函数解耦，或把共享类型放到 "),a("code",[s._v("pkg")]),s._v("（谨慎）或 "),a("code",[s._v("shared")]),s._v("（尽量少用）。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_2-推荐目录结构-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-推荐目录结构-示例"}},[s._v("#")]),s._v(" 2. 推荐目录结构（示例）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("myapp/\n├── cmd/\n│   └── myapp/             # 程序入口（main.go）——可多个 cmd\n│       └── main.go\n├── configs/               # 配置文件、模板\n├── internal/\n│   ├── domain/            # 领域层（只含接口、实体、领域服务、事件）\n│   │   ├── user/\n│   │   │   ├── entity.go\n│   │   │   ├── value_objects.go\n│   │   │   └── repository.go  # 仓储接口\n│   │   └── order/\n│   │       └── ...\n│   ├── application/       # 应用层（用例/事务协调、DTO、服务）\n│   │   └── usercase/\n│   │       ├── service.go\n│   │       └── dto.go\n│   ├── adapter/           # 适配器（输入/输出）实现\n│   │   ├── http/\n│   │   │   └── user_handler.go\n│   │   └── grpc/\n│   └── infra/             # 基础设施（DB、缓存、邮件、外部系统）\n│       ├── db/\n│       │   └── postgres_user_repo.go\n│       └── logger/\n├── api/                   # OpenAPI/Protos/接口定义\n├── pkg/                   # 可以被外部项目复用的包（小心使用）\n├── scripts/\n├── deployments/\n└── go.mod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("说明：")]),s._v(" "),a("ul",[a("li",[s._v("把业务代码放 "),a("code",[s._v("internal")]),s._v("，确保不会被外部 import（增强封装）。")]),s._v(" "),a("li",[a("code",[s._v("domain")]),s._v(" 只包含领域概念与仓储接口，不包含任何 ORM 或 HTTP 相关内容。")]),s._v(" "),a("li",[a("code",[s._v("adapter")]),s._v(" 或 "),a("code",[s._v("infra")]),s._v(" 放置实现（仓储实现、HTTP handler、消息总线消费者等）。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-包命名与文件命名规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-包命名与文件命名规范"}},[s._v("#")]),s._v(" 3. 包命名与文件命名规范")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("包名")]),s._v("：短小、单数、小写（例如 "),a("code",[s._v("user")]),s._v(", "),a("code",[s._v("order")]),s._v(", "),a("code",[s._v("payment")]),s._v("），不要下划线或驼峰。")]),s._v(" "),a("li",[a("strong",[s._v("避免使用 "),a("code",[s._v("domain")]),s._v(" 下的通用包名")]),s._v("（如 "),a("code",[s._v("models")]),s._v("、"),a("code",[s._v("common")]),s._v("）—这些通常招致职责不清。")]),s._v(" "),a("li",[a("strong",[s._v("文件名")]),s._v("：按职责细分（"),a("code",[s._v("entity.go")]),s._v(", "),a("code",[s._v("repository.go")]),s._v(", "),a("code",[s._v("service.go")]),s._v(", "),a("code",[s._v("handler_http.go")]),s._v("），避免单文件过大。")]),s._v(" "),a("li",[a("strong",[s._v("类型命名")]),s._v("：导出类型使用大写（"),a("code",[s._v("User")]),s._v(", "),a("code",[s._v("Order")]),s._v("）；非导出使用小写。")]),s._v(" "),a("li",[a("strong",[s._v("接口命名")]),s._v("：接口名建议用行为后缀（"),a("code",[s._v("UserRepository")]),s._v(", "),a("code",[s._v("PaymentGateway")]),s._v("），而不是 "),a("code",[s._v("IUser")]),s._v(" 风格。")]),s._v(" "),a("li",[a("strong",[s._v("变量/函数命名")]),s._v("：驼峰小写，导出函数首字母大写。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_4-领域层-internal-domain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-领域层-internal-domain"}},[s._v("#")]),s._v(" 4. 领域层（"),a("code",[s._v("internal/domain/...")]),s._v("）")]),s._v(" "),a("p",[s._v("特点：纯净、无依赖实现细节。")]),s._v(" "),a("p",[s._v("示例："),a("code",[s._v("internal/domain/user/entity.go")])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" user\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// User 是聚合根")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" User "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ID        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    Email     "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    Password  "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 哈希")]),s._v("\n    CreatedAt time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Time\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwordHash "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("User "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" passwordHash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" CreatedAt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ChangeEmail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 领域验证/不变式在此处实现")]),s._v("\n    u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Email "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("new")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("示例："),a("code",[s._v("internal/domain/user/repository.go")])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" user\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UserRepository 定义了持久化契约（接口）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" UserRepository "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("FindByID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("FindByEmail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("说明：领域层定义契约（接口），但不包含实现。实现应在 "),a("code",[s._v("internal/infra")]),s._v(" 或 "),a("code",[s._v("internal/adapter/persistence")]),s._v("。")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_5-应用层-internal-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-应用层-internal-application"}},[s._v("#")]),s._v(" 5. 应用层（"),a("code",[s._v("internal/application/...")]),s._v("）")]),s._v(" "),a("p",[s._v("职责：编排应用用例、组织事务、调用领域接口、转换 DTO。")]),s._v(" "),a("p",[s._v("示例："),a("code",[s._v("internal/application/usercase/service.go")])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" usercase\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"errors"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myapp/internal/domain/user"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" UserService "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    repo user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UserRepository\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewUserService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UserRepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("UserService "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("UserService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("UserService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwordHash "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 领域规则校验（可调用领域服务）")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" existing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("FindByEmail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" existing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" errors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("New")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email exists"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    u "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("generateID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwordHash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("注意：应用层可以处理事务边界（例如开始/提交 DB 事务），但应保持尽可能薄。")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_6-适配器-基础设施层-internal-adapter-internal-infra"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-适配器-基础设施层-internal-adapter-internal-infra"}},[s._v("#")]),s._v(" 6. 适配器/基础设施层（"),a("code",[s._v("internal/adapter")]),s._v(", "),a("code",[s._v("internal/infra")]),s._v("）")]),s._v(" "),a("p",[s._v("职责：把领域接口连接到具体技术实现（ORM、HTTP、消息队列）。")]),s._v(" "),a("p",[s._v("示例："),a("code",[s._v("internal/infra/db/postgres_user_repo.go")])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" db\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"database/sql"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myapp/internal/domain/user"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" PostgresUserRepo "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewPostgresUserRepo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("PostgresUserRepo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("PostgresUserRepo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("PostgresUserRepo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// SQL 操作")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("PostgresUserRepo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("FindByID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("PostgresUserRepo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("FindByEmail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("email "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("cmd/myapp/main.go")]),s._v(" 中构建依赖关系并注入：")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mustOpenDB")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    userRepo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewPostgresUserRepo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dbConn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    userSvc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" usercase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewUserService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userRepo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// wire up http handlers with userSvc")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_7-关于包名-user-user-的讨论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-关于包名-user-user-的讨论"}},[s._v("#")]),s._v(" 7. 关于包名 "),a("code",[s._v("user.User")]),s._v(" 的讨论")]),s._v(" "),a("p",[s._v("你可能注意到：在 Go 里 "),a("code",[s._v("user.User")]),s._v("（包名 + 类型名）经常出现。"),a("strong",[s._v("这是正常且符合惯例的")]),s._v("。它能清晰表达：类型 "),a("code",[s._v("User")]),s._v(" 属于 "),a("code",[s._v("user")]),s._v(" 包。但要注意：")]),s._v(" "),a("ul",[a("li",[s._v("若觉得冗余，可以在导入时起别名："),a("code",[s._v('u "myapp/internal/domain/user"')]),s._v("，使用 "),a("code",[s._v("u.User")]),s._v("。")]),s._v(" "),a("li",[s._v("不推荐把包也命名为 "),a("code",[s._v("models")]),s._v("、"),a("code",[s._v("entities")]),s._v(" 之类通用名，这会降低可读性。")]),s._v(" "),a("li",[s._v("建议按 "),a("strong",[s._v("聚合")]),s._v("（aggregate）建包："),a("code",[s._v("domain/user")]),s._v("、"),a("code",[s._v("domain/order")]),s._v("，更契合 DDD。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_8-事务与一致性边界"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-事务与一致性边界"}},[s._v("#")]),s._v(" 8. 事务与一致性边界")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("短事务")]),s._v("：在应用层开启并提交（例如在 service 方法内），把事务对象通过仓储实现传递。")]),s._v(" "),a("li",[a("strong",[s._v("跨聚合事务")]),s._v("：优先用最终一致性（事件/消息）而不是分布式事务（两阶段），除非必须。")])]),s._v(" "),a("p",[s._v("样例：在 "),a("code",[s._v("application")]),s._v(" 层开始事务：")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// pseudo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("DoSomething")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    tx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Begin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("defer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" tx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Rollback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" tx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// repo 使用 tx 实现")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_9-测试建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-测试建议"}},[s._v("#")]),s._v(" 9. 测试建议")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("领域单测")]),s._v("：只针对 "),a("code",[s._v("internal/domain/*")]),s._v(" 的行为和不变式编写单元测试（无需 DB）。")]),s._v(" "),a("li",[a("strong",[s._v("集成测试")]),s._v("：把 "),a("code",[s._v("infra")]),s._v(" 的实现替换为 test doubles 或使用测试 DB（docker-compose/testcontainers）。")]),s._v(" "),a("li",[a("strong",[s._v("端到端测试")]),s._v("：在 CI 中用真实依赖（容器化 DB / MQ）跑 e2e 测试。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_10-常见反模式与注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-常见反模式与注意事项"}},[s._v("#")]),s._v(" 10. 常见反模式与注意事项")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("把 ORM 代码放进 domain")]),s._v("：违反依赖倒置。领域应该只关心接口。")]),s._v(" "),a("li",[a("strong",[s._v("大而全的 "),a("code",[s._v("models")]),s._v(" 包")]),s._v("：职责模糊，容易形成循环依赖。")]),s._v(" "),a("li",[a("strong",[s._v("全局状态/单例数据库变量")]),s._v("：不利于测试与并发。")]),s._v(" "),a("li",[a("strong",[s._v("大量使用 "),a("code",[s._v("pkg/shared")])]),s._v("：导致隐性耦合，优先用明确的接口注入。")]),s._v(" "),a("li",[a("strong",[s._v("忽略错误包装")]),s._v("：在边界处用 "),a("code",[s._v("errors.Wrap")]),s._v(" 或 "),a("code",[s._v("%w")]),s._v(" 链接错误上下文，便于排查。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_11-代码风格-工具链建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-代码风格-工具链建议"}},[s._v("#")]),s._v(" 11. 代码风格 & 工具链建议")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("gofmt")]),s._v(" / "),a("code",[s._v("goimports")]),s._v(" / "),a("code",[s._v("golangci-lint")]),s._v("（开启 "),a("code",[s._v("govet")]),s._v(","),a("code",[s._v("staticcheck")]),s._v("）。")]),s._v(" "),a("li",[s._v("采用 "),a("code",[s._v("go test ./...")]),s._v(" 在 CI 中持续运行。使用 "),a("code",[s._v("-race")]),s._v(" 在集成测试中检查竞态。")]),s._v(" "),a("li",[s._v("依赖管理用 "),a("code",[s._v("go mod")]),s._v("，避免把 "),a("code",[s._v("vendor")]),s._v(" 弹性化管理滥用。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_12-实战示例-完整包关系小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-实战示例-完整包关系小结"}},[s._v("#")]),s._v(" 12. 实战示例（完整包关系小结）")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("internal/domain/user")]),s._v("：实体、值对象、仓储接口、领域服务。")]),s._v(" "),a("li",[a("code",[s._v("internal/application/usercase")]),s._v("：应用服务、DTO、用例编排。")]),s._v(" "),a("li",[a("code",[s._v("internal/infra/db")]),s._v("：Postgres/MySQL 的仓储实现。")]),s._v(" "),a("li",[a("code",[s._v("internal/adapter/http")]),s._v("：HTTP 层（处理 request -> DTO -> 调用 application service），返回标准化错误/响应。")])]),s._v(" "),a("p",[s._v("这样可以保证：领域不依赖 infra；infra 依赖 domain；application 把 domain 与 infra 组装起来。")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_13-最后一张清单-落地前检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-最后一张清单-落地前检查"}},[s._v("#")]),s._v(" 13. 最后一张清单（落地前检查）")]),s._v(" "),a("ul",[a("li",[s._v("[ ] 领域层：无任何第三方依赖。")]),s._v(" "),a("li",[s._v("[ ] 仓储接口放领域，具体实现放 infra/adapter。")]),s._v(" "),a("li",[s._v("[ ] 使用 "),a("code",[s._v("internal")]),s._v(" 隔离实现，暴露可复用组件放 "),a("code",[s._v("pkg")]),s._v("。")]),s._v(" "),a("li",[s._v("[ ] 包名小写、单数、职责单一。")]),s._v(" "),a("li",[s._v("[ ] 主函数（"),a("code",[s._v("cmd/")]),s._v("）负责依赖注入与启动。")]),s._v(" "),a("li",[s._v("[ ] CI 覆盖 "),a("code",[s._v("gofmt")]),s._v(", "),a("code",[s._v("golangci-lint")]),s._v(", "),a("code",[s._v("go test")]),s._v("。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"结语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[s._v("#")]),s._v(" 结语")]),s._v(" "),a("p",[s._v("把 DDD 的思路带入 Go 项目不是为了机械搬运概念，而是把“边界明确、职责单一、可测试、易演进”的工程实践落地。用 "),a("code",[s._v("internal")]),s._v("、短小清晰的包名、接口注入与慎用共享包，就能既保留 Go 的简洁，又实现领域驱动的长期可维护性。")])])}),[],!1,null,null,null);t.default=e.exports}}]);