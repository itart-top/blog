(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{703:function(s,a,t){"use strict";t.r(a);var e=t(8),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"rocky-no-such-file-or-directory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocky-no-such-file-or-directory"}},[s._v("#")]),s._v(" Rocky: No such file or directory")]),s._v(" "),t("p",[s._v("今天遇到一个很诡异的问题，在 Rocky Linux 系统上明明看到可执行文件就在眼前，运行时却提示 “No such file or directory”，折腾了半天终于找到原因，记录一下过程。")]),s._v(" "),t("h2",{attrs:{id:"问题现象-文件存在却-消失-了"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题现象-文件存在却-消失-了"}},[s._v("#")]),s._v(" 问题现象：文件存在却 “消失” 了")]),s._v(" "),t("p",[s._v("事情是这样的，我在服务器上部署一个叫"),t("code",[s._v("config-gray")]),s._v("的程序，通过"),t("code",[s._v("ll")]),s._v("命令明明能看到文件存在，而且权限也是对的（"),t("code",[s._v("rwxr-xr-x")]),s._v("）：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@xx config-gray"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll config-gray")]),s._v("\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18061992")]),s._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":34 config-gray\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("但当我执行"),t("code",[s._v("./config-gray")]),s._v("时，却报了个让人费解的错：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@xx config-gray"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./config-gray")]),s._v("\nbash: ./config-gray: No such "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这就很离谱了 —— 文件明明在这儿，怎么会 “找不到”？")]),s._v(" "),t("h2",{attrs:{id:"对比测试-centos-的错误更直白"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对比测试-centos-的错误更直白"}},[s._v("#")]),s._v(" 对比测试：CentOS 的错误更直白")]),s._v(" "),t("p",[s._v("为了排查问题，我在另一台 CentOS 7 服务器上试了下，同样的文件，报错信息稍微不一样：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master config-gray"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./config-gray")]),s._v("\n-bash: ./config-gray: /lib/ld-musl-x86_64.so.1: bad ELF interpreter: No such "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这次的错误清晰多了：找不到"),t("code",[s._v("/lib/ld-musl-x86_64.so.1")]),s._v("这个 ELF 解释器。")]),s._v(" "),t("h2",{attrs:{id:"原因分析-不是文件找不到-是依赖缺了"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因分析-不是文件找不到-是依赖缺了"}},[s._v("#")]),s._v(" 原因分析：不是文件找不到，是依赖缺了")]),s._v(" "),t("p",[s._v("结合两个系统的报错，终于理清了头绪：")]),s._v(" "),t("ul",[t("li",[s._v("第一个 Rocky 系统的 “文件不存在” 其实是个误导性错误。本质是系统找不到程序运行所需的动态链接器（解释器），导致操作系统无法加载程序，于是 “误以为” 文件不存在。")]),s._v(" "),t("li",[s._v("CentOS 的报错直接点出了核心：程序依赖"),t("code",[s._v("musl libc")]),s._v("的动态链接器（"),t("code",[s._v("ld-musl-x86_64.so.1")]),s._v("），但我的 Rocky 和 CentOS 系统默认装的是"),t("code",[s._v("glibc")]),s._v("，没有"),t("code",[s._v("musl")]),s._v("的相关库，所以找不到。")])]),s._v(" "),t("p",[s._v("再看一下编译命令，问题可能出在这里：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_ENABLED")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" go build -o config-gray -a -ldflags "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-extldflags '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("-static"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v(" -mod"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vendor "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("虽然加了"),t("code",[s._v("-static")]),s._v("参数想静态编译，但"),t("code",[s._v("CGO_ENABLED=1")]),s._v("开启了 CGO，可能导致编译时依赖了系统的"),t("code",[s._v("musl libc")]),s._v("（比如编译环境用了 Alpine 系统，默认是 musl），最终生成的二进制不是纯静态的，依然依赖 musl 的动态链接器。")]),s._v(" "),t("h2",{attrs:{id:"解决方法-两种思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-两种思路"}},[s._v("#")]),s._v(" 解决方法：两种思路")]),s._v(" "),t("h3",{attrs:{id:"_1-安装-musl-依赖-临时解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-musl-依赖-临时解决"}},[s._v("#")]),s._v(" 1. 安装 musl 依赖（临时解决）")]),s._v(" "),t("p",[s._v("如果只是想让程序在现有系统运行，可以直接安装"),t("code",[s._v("musl")]),s._v("相关库：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Rocky/CentOS 7+ 可以通过 EPEL 源安装：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先启用EPEL源")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y epel-release\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装musl-libs")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y musl-libs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])]),s._v(" "),t("p",[s._v("安装后再运行"),t("code",[s._v("./config-gray")]),s._v("，就能正常执行了。")]),s._v(" "),t("h3",{attrs:{id:"_2-重新编译为纯静态程序-彻底解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-重新编译为纯静态程序-彻底解决"}},[s._v("#")]),s._v(" 2. 重新编译为纯静态程序（彻底解决）")]),s._v(" "),t("p",[s._v("更根本的方法是调整编译参数，生成不依赖系统 libc 的纯静态二进制：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭CGO，使用Go自带的标准库（不依赖系统libc）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CGO_ENABLED")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" go build -o config-gray -a -ldflags "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-s -w"')]),s._v(" -mod"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vendor "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("CGO_ENABLED=0")]),s._v("：禁用 CGO，避免依赖系统 libc（不管是 glibc 还是 musl）")]),s._v(" "),t("li",[t("code",[s._v("-s -w")]),s._v("：移除符号表和调试信息，减小二进制体积")])]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("这次踩坑让我明白：遇到 “文件存在却提示找不到” 的情况，别光看文件本身，很大可能是"),t("strong",[s._v("程序依赖的动态链接库或解释器缺失")]),s._v("。尤其是跨系统部署时，不同 Linux 发行版的 libc（glibc/musl）差异可能导致这类问题，编译时尽量用纯静态编译（"),t("code",[s._v("CGO_ENABLED=0")]),s._v("）能减少很多麻烦。")])])}),[],!1,null,null,null);a.default=r.exports}}]);