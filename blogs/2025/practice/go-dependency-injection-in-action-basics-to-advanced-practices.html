<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Go 语言依赖注入实战指南：从基础到高级实践 | 艺术码农的小栈</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="IT是一门艺术">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.33ec4896.css" as="style"><link rel="preload" href="/assets/js/app.26b7b206.js" as="script"><link rel="preload" href="/assets/js/4.34a1f699.js" as="script"><link rel="preload" href="/assets/js/1.fa01cbc2.js" as="script"><link rel="preload" href="/assets/js/89.acc39148.js" as="script"><link rel="prefetch" href="/assets/js/10.a1e795ad.js"><link rel="prefetch" href="/assets/js/11.f31056c6.js"><link rel="prefetch" href="/assets/js/12.b1eb3e6b.js"><link rel="prefetch" href="/assets/js/13.c4103c4c.js"><link rel="prefetch" href="/assets/js/14.528f041b.js"><link rel="prefetch" href="/assets/js/15.fb7c17bd.js"><link rel="prefetch" href="/assets/js/16.98c5f335.js"><link rel="prefetch" href="/assets/js/17.e12e3b8c.js"><link rel="prefetch" href="/assets/js/18.7e23d69f.js"><link rel="prefetch" href="/assets/js/19.4e6e4ff3.js"><link rel="prefetch" href="/assets/js/20.ecb8a1dc.js"><link rel="prefetch" href="/assets/js/21.fbb4f60e.js"><link rel="prefetch" href="/assets/js/22.6ed3ace2.js"><link rel="prefetch" href="/assets/js/23.21b67b7b.js"><link rel="prefetch" href="/assets/js/24.3560b691.js"><link rel="prefetch" href="/assets/js/25.977944c8.js"><link rel="prefetch" href="/assets/js/26.ae364031.js"><link rel="prefetch" href="/assets/js/27.abd90669.js"><link rel="prefetch" href="/assets/js/28.66696cc6.js"><link rel="prefetch" href="/assets/js/29.7b8fcf5f.js"><link rel="prefetch" href="/assets/js/3.14088b1f.js"><link rel="prefetch" href="/assets/js/30.18933227.js"><link rel="prefetch" href="/assets/js/31.bddcef69.js"><link rel="prefetch" href="/assets/js/32.eac5c260.js"><link rel="prefetch" href="/assets/js/33.57270104.js"><link rel="prefetch" href="/assets/js/34.ff0b3fbd.js"><link rel="prefetch" href="/assets/js/35.3f118186.js"><link rel="prefetch" href="/assets/js/36.5b32678d.js"><link rel="prefetch" href="/assets/js/37.8bdc3852.js"><link rel="prefetch" href="/assets/js/38.1c416da5.js"><link rel="prefetch" href="/assets/js/39.66ab3b68.js"><link rel="prefetch" href="/assets/js/40.24b0eb4f.js"><link rel="prefetch" href="/assets/js/41.d8a9d8cd.js"><link rel="prefetch" href="/assets/js/42.7552d30b.js"><link rel="prefetch" href="/assets/js/43.acf26f99.js"><link rel="prefetch" href="/assets/js/44.c7588fd9.js"><link rel="prefetch" href="/assets/js/45.111f27e2.js"><link rel="prefetch" href="/assets/js/46.3450f7a7.js"><link rel="prefetch" href="/assets/js/47.6856be26.js"><link rel="prefetch" href="/assets/js/48.8febc898.js"><link rel="prefetch" href="/assets/js/49.0408eb3f.js"><link rel="prefetch" href="/assets/js/5.f8b726c1.js"><link rel="prefetch" href="/assets/js/50.ce1e315b.js"><link rel="prefetch" href="/assets/js/51.4cec59d7.js"><link rel="prefetch" href="/assets/js/52.7f11a198.js"><link rel="prefetch" href="/assets/js/53.61242f1b.js"><link rel="prefetch" href="/assets/js/54.d1f179eb.js"><link rel="prefetch" href="/assets/js/55.7da8ef79.js"><link rel="prefetch" href="/assets/js/56.2fb16d8d.js"><link rel="prefetch" href="/assets/js/57.169e1575.js"><link rel="prefetch" href="/assets/js/58.95211ddc.js"><link rel="prefetch" href="/assets/js/59.8389c0c4.js"><link rel="prefetch" href="/assets/js/6.be26a4fd.js"><link rel="prefetch" href="/assets/js/60.dbca9aae.js"><link rel="prefetch" href="/assets/js/61.e1143c0a.js"><link rel="prefetch" href="/assets/js/62.f3f7add9.js"><link rel="prefetch" href="/assets/js/63.328ca412.js"><link rel="prefetch" href="/assets/js/64.a0416026.js"><link rel="prefetch" href="/assets/js/65.6b761eca.js"><link rel="prefetch" href="/assets/js/66.7c071d8b.js"><link rel="prefetch" href="/assets/js/67.5e297bf1.js"><link rel="prefetch" href="/assets/js/68.685c6dd4.js"><link rel="prefetch" href="/assets/js/69.b90973ab.js"><link rel="prefetch" href="/assets/js/7.6051ac3d.js"><link rel="prefetch" href="/assets/js/70.7948ee53.js"><link rel="prefetch" href="/assets/js/71.800033d5.js"><link rel="prefetch" href="/assets/js/72.5ed4310b.js"><link rel="prefetch" href="/assets/js/73.2367d439.js"><link rel="prefetch" href="/assets/js/74.26f08eca.js"><link rel="prefetch" href="/assets/js/75.65f5b3d3.js"><link rel="prefetch" href="/assets/js/76.db8b2024.js"><link rel="prefetch" href="/assets/js/77.fc412538.js"><link rel="prefetch" href="/assets/js/78.92b44f25.js"><link rel="prefetch" href="/assets/js/79.b10bae1e.js"><link rel="prefetch" href="/assets/js/8.76fd16fb.js"><link rel="prefetch" href="/assets/js/80.742d6ecd.js"><link rel="prefetch" href="/assets/js/81.76a1d778.js"><link rel="prefetch" href="/assets/js/82.0301eeb7.js"><link rel="prefetch" href="/assets/js/83.a4ae9472.js"><link rel="prefetch" href="/assets/js/84.fe82531d.js"><link rel="prefetch" href="/assets/js/85.5ed6d46d.js"><link rel="prefetch" href="/assets/js/86.bf719bcc.js"><link rel="prefetch" href="/assets/js/87.3f96dc56.js"><link rel="prefetch" href="/assets/js/88.148a861c.js"><link rel="prefetch" href="/assets/js/9.842229ff.js"><link rel="prefetch" href="/assets/js/90.e98d95a2.js"><link rel="prefetch" href="/assets/js/91.44e60548.js"><link rel="prefetch" href="/assets/js/92.55a62ae6.js"><link rel="prefetch" href="/assets/js/93.300f0878.js"><link rel="prefetch" href="/assets/js/94.7c7423e2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.33ec4896.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>艺术码农的小栈</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>IT是一门艺术</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Hyman</span>
            
          <span data-v-4e82dffc>2009 - </span>
          2025
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="艺术码农的小栈" class="logo"> <span class="site-name">艺术码农的小栈</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      随手笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/实践总结/" class="nav-link"><i class="undefined"></i>
  实践总结
</a></li><li class="dropdown-item"><!----> <a href="/categories/K8S/" class="nav-link"><i class="undefined"></i>
  K8S
</a></li><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/探索/" class="nav-link"><i class="undefined"></i>
  探索
</a></li><li class="dropdown-item"><!----> <a href="/categories/转载/" class="nav-link"><i class="undefined"></i>
  转载
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      主页
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/itart-top" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/piaohai" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Hyman
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>84</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>33</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      随手笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/实践总结/" class="nav-link"><i class="undefined"></i>
  实践总结
</a></li><li class="dropdown-item"><!----> <a href="/categories/K8S/" class="nav-link"><i class="undefined"></i>
  K8S
</a></li><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/探索/" class="nav-link"><i class="undefined"></i>
  探索
</a></li><li class="dropdown-item"><!----> <a href="/categories/转载/" class="nav-link"><i class="undefined"></i>
  转载
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      主页
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/itart-top" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/piaohai" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Go 语言依赖注入实战指南：从基础到高级实践</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Hyman</span>
            
          <span data-v-4e82dffc>2009 - </span>
          2025
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Go 语言依赖注入实战指南：从基础到高级实践</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Hyman</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2025/11/4</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>实践总结</span><span class="tag-item" data-v-1ff7123e>最佳</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="一、从痛点开始-如果没有依赖注入会怎样"><a href="#一、从痛点开始-如果没有依赖注入会怎样" class="header-anchor">#</a> 一、从痛点开始：如果没有依赖注入会怎样？</h2> <p>让我们先看一个反例，了解没有依赖注入时的问题：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// bad: user_service.go</span>
<span class="token keyword">package</span> service

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;database/sql&quot;</span>
    <span class="token boolean">_</span> <span class="token string">&quot;github.com/go-sql-driver/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> UserService <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>UserService<span class="token punctuation">)</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:pwd@tcp(localhost:3306)/test&quot;</span><span class="token punctuation">)</span> <span class="token comment">// ❌ 在这里创建依赖</span>
    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> name <span class="token builtin">string</span>
    err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name FROM users WHERE id=?&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> name<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>这个简单示例暴露了几个致命问题：</p> <ul><li><strong>紧耦合</strong>：<code>UserService</code>自己知道数据库实现细节，无法替换其他数据库实现</li> <li><strong>性能差</strong>：每次调用都会创建新连接，没有连接复用</li> <li><strong>无法测试</strong>：测试时必须连接真实数据库，无法进行单元测试</li> <li><strong>违反开闭原则</strong>：新增或修改数据源时需要修改服务代码</li></ul> <p>这就是依赖注入要解决的核心问题：<strong>将依赖的创建与使用分离</strong></p> <h2 id="二、重构-引入依赖注入"><a href="#二、重构-引入依赖注入" class="header-anchor">#</a> 二、重构：引入依赖注入</h2> <h3 id="_1️⃣-定义接口-隔离依赖"><a href="#_1️⃣-定义接口-隔离依赖" class="header-anchor">#</a> 1️⃣ 定义接口（隔离依赖）</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// domain/user.go</span>
<span class="token keyword">package</span> domain

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ID   <span class="token builtin">int</span>
    Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> UserRepo <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">GetByID</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>最佳实践</strong>：始终面向接口编程，确保依赖项的抽象性和可替换性</p> <h3 id="_2️⃣-实现接口-可替换"><a href="#_2️⃣-实现接口-可替换" class="header-anchor">#</a> 2️⃣ 实现接口（可替换）</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// infra/mysql_user_repo.go</span>
<span class="token keyword">package</span> infra

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;database/sql&quot;</span>
    <span class="token string">&quot;go-di-example/domain&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> MySQLUserRepo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewMySQLRepo</span><span class="token punctuation">(</span>db <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>MySQLUserRepo <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>MySQLUserRepo<span class="token punctuation">{</span>db<span class="token punctuation">:</span> db<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>MySQLUserRepo<span class="token punctuation">)</span> <span class="token function">GetByID</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>domain<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> u domain<span class="token punctuation">.</span>User
    err <span class="token operator">:=</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id,name FROM users WHERE id=?&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token operator">&amp;</span>u<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3️⃣-在服务层注入依赖"><a href="#_3️⃣-在服务层注入依赖" class="header-anchor">#</a> 3️⃣ 在服务层注入依赖</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// service/user_service.go</span>
<span class="token keyword">package</span> service

<span class="token keyword">import</span> <span class="token string">&quot;go-di-example/domain&quot;</span>

<span class="token keyword">type</span> UserService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    repo domain<span class="token punctuation">.</span>UserRepo  <span class="token comment">// 依赖接口而非实现</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewUserService</span><span class="token punctuation">(</span>repo domain<span class="token punctuation">.</span>UserRepo<span class="token punctuation">)</span> <span class="token operator">*</span>UserService <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>UserService<span class="token punctuation">{</span>repo<span class="token punctuation">:</span> repo<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>UserService<span class="token punctuation">)</span> <span class="token function">GetUserName</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    u<span class="token punctuation">,</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">GetByID</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> u<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>构造函数注入</strong>是最推荐的方式，因为它明确了依赖关系且易于测试</p> <h3 id="_4️⃣-在主函数组装-composition-root"><a href="#_4️⃣-在主函数组装-composition-root" class="header-anchor">#</a> 4️⃣ 在主函数组装（Composition Root）</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// main.go</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;database/sql&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;go-di-example/infra&quot;</span>
    <span class="token string">&quot;go-di-example/service&quot;</span>
    <span class="token boolean">_</span> <span class="token string">&quot;github.com/go-sql-driver/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 依赖创建集中在入口处</span>
    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:pwd@tcp(localhost:3306)/test&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 依赖注入</span>
    repo <span class="token operator">:=</span> infra<span class="token punctuation">.</span><span class="token function">NewMySQLRepo</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
    userSvc <span class="token operator">:=</span> service<span class="token punctuation">.</span><span class="token function">NewUserService</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>  <span class="token comment">// 注入Repository</span>

    name<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> userSvc<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;User:&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>架构分层</strong>：典型的 Web 项目采用 Handler→Service→Repository→Model 四层架构，各层通过接口解耦</p> <h2 id="三、go-中依赖注入的-3-种原生实现方式"><a href="#三、go-中依赖注入的-3-种原生实现方式" class="header-anchor">#</a> 三、Go 中依赖注入的 3 种原生实现方式</h2> <h3 id="_1-构造函数注入-最常用"><a href="#_1-构造函数注入-最常用" class="header-anchor">#</a> 1. 构造函数注入（最常用）</h3> <p>通过构造函数将依赖作为参数传入，确保对象创建时依赖已完备。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewUserService</span><span class="token punctuation">(</span>repo UserRepository<span class="token punctuation">)</span> <span class="token operator">*</span>UserService <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>UserService<span class="token punctuation">{</span>repo<span class="token punctuation">:</span> repo<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-方法注入-setter-method"><a href="#_2-方法注入-setter-method" class="header-anchor">#</a> 2. 方法注入（Setter method）</h3> <p>通过 Setter 方法动态注入依赖。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>UserService<span class="token punctuation">)</span> <span class="token function">SetRepository</span><span class="token punctuation">(</span>repo UserRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s<span class="token punctuation">.</span>repo <span class="token operator">=</span> repo
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-函数参数注入"><a href="#_3-函数参数注入" class="header-anchor">#</a> 3. 函数参数注入</h3> <p>将依赖作为函数参数直接传入。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ProcessUser</span><span class="token punctuation">(</span>repo UserRepository<span class="token punctuation">,</span> userID <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> repo<span class="token punctuation">.</span><span class="token function">GetByID</span><span class="token punctuation">(</span>userID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-属性注入-直接赋值"><a href="#_4-属性注入-直接赋值" class="header-anchor">#</a> 4. 属性注入（直接赋值）</h3> <p>直接对结构体的字段赋值进行依赖注入。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>service <span class="token operator">:=</span> <span class="token operator">&amp;</span>UserService<span class="token punctuation">{</span><span class="token punctuation">}</span>
service<span class="token punctuation">.</span>Repo <span class="token operator">=</span> <span class="token operator">&amp;</span>MySQLUserRepo<span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 手动注入</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="四、测试中使用-di-mock-示例"><a href="#四、测试中使用-di-mock-示例" class="header-anchor">#</a> 四、测试中使用 DI（Mock 示例）</h2> <p>依赖注入的最大优势之一：可测试性</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// service/user_service_test.go</span>
<span class="token keyword">package</span> service_test

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;testing&quot;</span>
    <span class="token string">&quot;go-di-example/domain&quot;</span>
    <span class="token string">&quot;go-di-example/service&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Mock 实现</span>
<span class="token keyword">type</span> MockUserRepo <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>MockUserRepo<span class="token punctuation">)</span> <span class="token function">GetByID</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>domain<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>domain<span class="token punctuation">.</span>User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> id<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;TestUser&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestUserService_GetUserName</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注入 Mock 依赖</span>
    repo <span class="token operator">:=</span> <span class="token operator">&amp;</span>MockUserRepo<span class="token punctuation">{</span><span class="token punctuation">}</span>
    svc <span class="token operator">:=</span> service<span class="token punctuation">.</span><span class="token function">NewUserService</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>

    name<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;unexpected error: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">&quot;TestUser&quot;</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;expected TestUser, got %s&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="五、当依赖很多时怎么办-functional-options-模式"><a href="#五、当依赖很多时怎么办-functional-options-模式" class="header-anchor">#</a> 五、当依赖很多时怎么办？（Functional Options 模式）</h2> <p>当依赖较多时，构造函数参数会很长：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// 传统方式 - 参数过多</span>
svc <span class="token operator">:=</span> <span class="token function">NewOrderService</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> repo<span class="token punctuation">,</span> cache<span class="token punctuation">,</span> metrics<span class="token punctuation">,</span> notifier<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用 **函数式选项模式（Functional Options）**解决：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> OrderService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    repo    UserRepository
    logger  Logger
    cache   Cache
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Option <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>OrderService<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">WithLogger</span><span class="token punctuation">(</span>l Logger<span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token operator">*</span>OrderService<span class="token punctuation">)</span> <span class="token punctuation">{</span> s<span class="token punctuation">.</span>logger <span class="token operator">=</span> l <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithCache</span><span class="token punctuation">(</span>c Cache<span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token operator">*</span>OrderService<span class="token punctuation">)</span> <span class="token punctuation">{</span> s<span class="token punctuation">.</span>cache <span class="token operator">=</span> c <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewOrderService</span><span class="token punctuation">(</span>repo UserRepository<span class="token punctuation">,</span> opts <span class="token operator">...</span>Option<span class="token punctuation">)</span> <span class="token operator">*</span>OrderService <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> <span class="token operator">&amp;</span>OrderService<span class="token punctuation">{</span>repo<span class="token punctuation">:</span> repo<span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> opt <span class="token operator">:=</span> <span class="token keyword">range</span> opts <span class="token punctuation">{</span>
        <span class="token function">opt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> s
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
svc <span class="token operator">:=</span> <span class="token function">NewOrderService</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> <span class="token function">WithLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WithCache</span><span class="token punctuation">(</span>redis<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>这种方式让构造灵活、参数清晰，避免了长参数列表的问题，通常针对的是可选参数。</p> <h2 id="六、复杂项目的自动注入工具-go-wire"><a href="#六、复杂项目的自动注入工具-go-wire" class="header-anchor">#</a> 六、复杂项目的自动注入工具（Go Wire）</h2> <p>对于大型项目，手动管理依赖关系变得复杂，可以使用 <strong>Google Wire</strong>自动生成依赖注入代码</p> <h3 id="_1-安装-wire"><a href="#_1-安装-wire" class="header-anchor">#</a> 1. 安装 Wire</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">go</span> install github<span class="token punctuation">.</span>com<span class="token operator">/</span>google<span class="token operator">/</span>wire<span class="token operator">/</span>cmd<span class="token operator">/</span>wire@latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-配置依赖关系"><a href="#_2-配置依赖关系" class="header-anchor">#</a> 2. 配置依赖关系</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// +build wireinject</span>
<span class="token keyword">func</span> <span class="token function">InitializeUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>service<span class="token punctuation">.</span>UserService <span class="token punctuation">{</span>
    wire<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span>
        infra<span class="token punctuation">.</span>NewMySQLUserRepo<span class="token punctuation">,</span> 
        service<span class="token punctuation">.</span>NewUserService<span class="token punctuation">,</span>
        wire<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token function">new</span><span class="token punctuation">(</span>domain<span class="token punctuation">.</span>UserRepo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">*</span>infra<span class="token punctuation">.</span>MySQLUserRepo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-生成代码"><a href="#_3-生成代码" class="header-anchor">#</a> 3. 生成代码</h3> <p>运行 <code>wire</code>命令后，生成 <code>wire_gen.go</code>：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Code generated by Wire. DO NOT EDIT.</span>
<span class="token keyword">func</span> <span class="token function">InitializeUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>service<span class="token punctuation">.</span>UserService <span class="token punctuation">{</span>
    db <span class="token operator">:=</span> infra<span class="token punctuation">.</span><span class="token function">NewMySQLUserRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    userService <span class="token operator">:=</span> service<span class="token punctuation">.</span><span class="token function">NewUserService</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
    <span class="token keyword">return</span> userService
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Wire 的优势</strong></p> <ul><li>编译时依赖注入，类型安全</li> <li>自动处理复杂的依赖关系图</li> <li>解决循环依赖问题</li></ul> <h2 id="七、解决循环依赖问题"><a href="#七、解决循环依赖问题" class="header-anchor">#</a> 七、解决循环依赖问题</h2> <p>Go 语言不允许包级别的循环依赖，但通过依赖注入可以优雅解决</p> <h3 id="问题场景"><a href="#问题场景" class="header-anchor">#</a> 问题场景：</h3> <ul><li>UserService 需要 AuditLogger</li> <li>AuditService 需要 UserService</li></ul> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案：</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// 1. 定义审计接口</span>
<span class="token keyword">package</span> user
<span class="token keyword">type</span> Logger <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">LogAction</span><span class="token punctuation">(</span>userID <span class="token builtin">string</span><span class="token punctuation">,</span> action <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 用户服务依赖审计接口</span>
<span class="token keyword">package</span> user
<span class="token keyword">type</span> UserService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    auditLogger Logger
<span class="token punctuation">}</span>

<span class="token comment">// 3. 审计服务通过接口依赖用户服务</span>
<span class="token keyword">package</span> audit
<span class="token keyword">type</span> AuditService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    getUserFunc <span class="token keyword">func</span><span class="token punctuation">(</span>id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>user<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token comment">// 通过函数抽象</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>使用 Wire 配置双向依赖：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">InitializeServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>user<span class="token punctuation">.</span>UserService<span class="token punctuation">,</span> <span class="token operator">*</span>audit<span class="token punctuation">.</span>AuditService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wire<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span>
        user<span class="token punctuation">.</span>NewUserService<span class="token punctuation">,</span>
        audit<span class="token punctuation">.</span>NewAuditService<span class="token punctuation">,</span>
        wire<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token function">new</span><span class="token punctuation">(</span>audit<span class="token punctuation">.</span>Logger<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">*</span>audit<span class="token punctuation">.</span>AuditService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>user<span class="token punctuation">.</span>UserService<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>audit<span class="token punctuation">.</span>AuditService<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="八、错误示例与对比-常见坑"><a href="#八、错误示例与对比-常见坑" class="header-anchor">#</a> 八、错误示例与对比（常见坑）</h2> <table><thead><tr><th style="text-align:left;">反例</th> <th style="text-align:left;">问题</th> <th style="text-align:left;">改进</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>var DB *sql.DB</code>（全局变量）</td> <td style="text-align:left;">隐式依赖，测试困难</td> <td style="text-align:left;">显式通过构造函数传入</td></tr> <tr><td style="text-align:left;">构造函数中启动 goroutine</td> <td style="text-align:left;">难控制生命周期</td> <td style="text-align:left;">把启动逻辑放到 Start() 方法</td></tr> <tr><td style="text-align:left;">在包 init() 创建资源</td> <td style="text-align:left;">无法注入、mock</td> <td style="text-align:left;">改为显式 NewXxx()</td></tr> <tr><td style="text-align:left;">构造时 panic</td> <td style="text-align:left;">程序崩溃难排查</td> <td style="text-align:left;">返回 error，让上层处理</td></tr> <tr><td style="text-align:left;">注入具体类型</td> <td style="text-align:left;">无法替换</td> <td style="text-align:left;">注入接口</td></tr></tbody></table> <p><strong>典型错误示例</strong>：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ❌ 错误：滥用全局变量</span>
<span class="token keyword">var</span> globalDB <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    globalDB <span class="token operator">=</span> <span class="token function">NewMySQLDB</span><span class="token punctuation">(</span><span class="token string">&quot;root:123456@tcp(127.0.0.1:3306)/test&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> UserService <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>UserService<span class="token punctuation">)</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> globalDB<span class="token punctuation">.</span><span class="token function">QueryUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>  <span class="token comment">// 测试时无法替换为Mock</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>正确做法</strong>：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ✅ 正确：通过注入替换全局</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db <span class="token operator">:=</span> <span class="token function">NewMySQLDB</span><span class="token punctuation">(</span><span class="token string">&quot;root:123456@tcp(127.0.0.1:3306)/test&quot;</span><span class="token punctuation">)</span>
    userService <span class="token operator">:=</span> <span class="token function">NewUserService</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>  <span class="token comment">// 测试时可传MockDB</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="九、ddd-中的依赖注入与并发处理"><a href="#九、ddd-中的依赖注入与并发处理" class="header-anchor">#</a> 九、DDD 中的依赖注入与并发处理</h2> <p>在领域驱动设计（DDD）中，依赖注入结合并发控制可以构建高性能应用</p> <h3 id="工作池模式示例"><a href="#工作池模式示例" class="header-anchor">#</a> 工作池模式示例：</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> OrderProcessor <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    workers      <span class="token builtin">int</span>
    jobs         <span class="token keyword">chan</span> <span class="token operator">*</span>Order
    orderService OrderService  <span class="token comment">// 依赖注入</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>OrderProcessor<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wg <span class="token operator">:=</span> <span class="token operator">&amp;</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span>workers<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> order <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>jobs <span class="token punctuation">{</span>
                <span class="token keyword">select</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span>
                <span class="token keyword">default</span><span class="token punctuation">:</span>
                    p<span class="token punctuation">.</span><span class="token function">processOrder</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> order<span class="token punctuation">)</span>  <span class="token comment">// 并发处理</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="领域事件的并发处理"><a href="#领域事件的并发处理" class="header-anchor">#</a> 领域事件的并发处理：</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> EventBus <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    handlers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>EventHandler
    mutex    sync<span class="token punctuation">.</span>RWMutex  <span class="token comment">// 保护共享资源</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EventBus<span class="token punctuation">)</span> <span class="token function">Publish</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> event Event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>mutex<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    handlers <span class="token operator">:=</span> b<span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>event<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    b<span class="token punctuation">.</span>mutex<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    wg <span class="token operator">:=</span> <span class="token operator">&amp;</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> handler <span class="token operator">:=</span> <span class="token keyword">range</span> handlers <span class="token punctuation">{</span>
        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>h EventHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">h</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> event<span class="token punctuation">)</span>  <span class="token comment">// 并发处理事件</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>并发最佳实践</strong></p> <ul><li>使用 <code>context</code>控制超时和取消</li> <li>合理使用 goroutine 池避免资源耗尽</li> <li>使用互斥锁保护共享资源</li> <li>正确处理 channel 的关闭</li></ul> <h2 id="十、总结-go-风格的依赖注入哲学"><a href="#十、总结-go-风格的依赖注入哲学" class="header-anchor">#</a> 十、总结：Go 风格的依赖注入哲学</h2> <table><thead><tr><th style="text-align:left;">原则</th> <th style="text-align:left;">含义</th> <th style="text-align:left;">实践</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>显式优于隐式</strong></td> <td style="text-align:left;">函数签名展示依赖，不藏着掖着</td> <td style="text-align:left;">通过构造函数参数明确依赖关系</td></tr> <tr><td style="text-align:left;"><strong>构造函数管理依赖</strong></td> <td style="text-align:left;">谁创建谁负责销毁</td> <td style="text-align:left;">在 Composition Root 集中管理生命周期</td></tr> <tr><td style="text-align:left;"><strong>接口驱动设计</strong></td> <td style="text-align:left;">依赖抽象而非实现</td> <td style="text-align:left;">定义接口，多种实现可替换</td></tr> <tr><td style="text-align:left;"><strong>可替换、可测试</strong></td> <td style="text-align:left;">模块化开发、单元测试更轻松</td> <td style="text-align:left;">依赖接口便于 Mock 测试</td></tr> <tr><td style="text-align:left;"><strong>最小化依赖</strong></td> <td style="text-align:left;">保持组件简单专注</td> <td style="text-align:left;">只注入必要的依赖，避免&quot;上帝对象&quot;</td></tr> <tr><td style="text-align:left;"><strong>避免全局状态</strong></td> <td style="text-align:left;">减少副作用</td> <td style="text-align:left;">通过注入替代全局变量</td></tr></tbody></table> <h2 id="十一、选择适合项目的-di-方式"><a href="#十一、选择适合项目的-di-方式" class="header-anchor">#</a> 十一、选择适合项目的 DI 方式</h2> <p>根据项目复杂度选择合适方案</p> <table><thead><tr><th style="text-align:left;">项目规模</th> <th style="text-align:left;">推荐方案</th> <th style="text-align:left;">优势</th></tr></thead> <tbody><tr><td style="text-align:left;">小型项目</td> <td style="text-align:left;">构造函数注入</td> <td style="text-align:left;">简单直观，无额外依赖</td></tr> <tr><td style="text-align:left;">中型项目</td> <td style="text-align:left;">函数式选项</td> <td style="text-align:left;">灵活，易于扩展</td></tr> <tr><td style="text-align:left;">大型项目</td> <td style="text-align:left;">Google Wire</td> <td style="text-align:left;">自动化，类型安全，易维护</td></tr></tbody></table> <h2 id="十二、结语"><a href="#十二、结语" class="header-anchor">#</a> 十二、结语</h2> <p>依赖注入不是&quot;复杂的框架&quot;，而是让 Go 代码更&quot;显式、清晰、可测试&quot;的工程实践。在 Go 世界里，我们不追求魔法容器，而追求结构化的依赖与明确的生命周期。</p> <p><strong>核心价值</strong>：</p> <ul><li><strong>解耦</strong>：依赖与使用方分离，避免&quot;牵一发而动全身&quot;</li> <li><strong>易测试</strong>：可轻松替换真实依赖为 Mock</li> <li><strong>灵活性</strong>：切换依赖实现时无需修改使用方代码</li> <li><strong>可维护性</strong>：依赖关系清晰，代码更易于维护和扩展</li></ul> <p>通过本文的示例和实践指南，您可以在项目中逐步应用依赖注入，构建更加健壮和可维护的 Go 应用程序。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#一、从痛点开始-如果没有依赖注入会怎样" class="sidebar-link reco-side-一、从痛点开始-如果没有依赖注入会怎样" data-v-70334359>一、从痛点开始：如果没有依赖注入会怎样？</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#二、重构-引入依赖注入" class="sidebar-link reco-side-二、重构-引入依赖注入" data-v-70334359>二、重构：引入依赖注入</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_1️⃣-定义接口-隔离依赖" class="sidebar-link reco-side-_1️⃣-定义接口-隔离依赖" data-v-70334359>1️⃣ 定义接口（隔离依赖）</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_2️⃣-实现接口-可替换" class="sidebar-link reco-side-_2️⃣-实现接口-可替换" data-v-70334359>2️⃣ 实现接口（可替换）</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_3️⃣-在服务层注入依赖" class="sidebar-link reco-side-_3️⃣-在服务层注入依赖" data-v-70334359>3️⃣ 在服务层注入依赖</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_4️⃣-在主函数组装-composition-root" class="sidebar-link reco-side-_4️⃣-在主函数组装-composition-root" data-v-70334359>4️⃣ 在主函数组装（Composition Root）</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#三、go-中依赖注入的-3-种原生实现方式" class="sidebar-link reco-side-三、go-中依赖注入的-3-种原生实现方式" data-v-70334359>三、Go 中依赖注入的 3 种原生实现方式</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_1-构造函数注入-最常用" class="sidebar-link reco-side-_1-构造函数注入-最常用" data-v-70334359>1. 构造函数注入（最常用）</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_2-方法注入-setter-method" class="sidebar-link reco-side-_2-方法注入-setter-method" data-v-70334359>2. 方法注入（Setter method）</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_3-函数参数注入" class="sidebar-link reco-side-_3-函数参数注入" data-v-70334359>3. 函数参数注入</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_4-属性注入-直接赋值" class="sidebar-link reco-side-_4-属性注入-直接赋值" data-v-70334359>4. 属性注入（直接赋值）</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#四、测试中使用-di-mock-示例" class="sidebar-link reco-side-四、测试中使用-di-mock-示例" data-v-70334359>四、测试中使用 DI（Mock 示例）</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#五、当依赖很多时怎么办-functional-options-模式" class="sidebar-link reco-side-五、当依赖很多时怎么办-functional-options-模式" data-v-70334359>五、当依赖很多时怎么办？（Functional Options 模式）</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#六、复杂项目的自动注入工具-go-wire" class="sidebar-link reco-side-六、复杂项目的自动注入工具-go-wire" data-v-70334359>六、复杂项目的自动注入工具（Go Wire）</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_1-安装-wire" class="sidebar-link reco-side-_1-安装-wire" data-v-70334359>1. 安装 Wire</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_2-配置依赖关系" class="sidebar-link reco-side-_2-配置依赖关系" data-v-70334359>2. 配置依赖关系</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#_3-生成代码" class="sidebar-link reco-side-_3-生成代码" data-v-70334359>3. 生成代码</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#七、解决循环依赖问题" class="sidebar-link reco-side-七、解决循环依赖问题" data-v-70334359>七、解决循环依赖问题</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#问题场景" class="sidebar-link reco-side-问题场景" data-v-70334359>问题场景：</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#解决方案" class="sidebar-link reco-side-解决方案" data-v-70334359>解决方案：</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#八、错误示例与对比-常见坑" class="sidebar-link reco-side-八、错误示例与对比-常见坑" data-v-70334359>八、错误示例与对比（常见坑）</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#九、ddd-中的依赖注入与并发处理" class="sidebar-link reco-side-九、ddd-中的依赖注入与并发处理" data-v-70334359>九、DDD 中的依赖注入与并发处理</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#工作池模式示例" class="sidebar-link reco-side-工作池模式示例" data-v-70334359>工作池模式示例：</a></li><li class="level-3" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#领域事件的并发处理" class="sidebar-link reco-side-领域事件的并发处理" data-v-70334359>领域事件的并发处理：</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#十、总结-go-风格的依赖注入哲学" class="sidebar-link reco-side-十、总结-go-风格的依赖注入哲学" data-v-70334359>十、总结：Go 风格的依赖注入哲学</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#十一、选择适合项目的-di-方式" class="sidebar-link reco-side-十一、选择适合项目的-di-方式" data-v-70334359>十一、选择适合项目的 DI 方式</a></li><li class="level-2" data-v-70334359><a href="/blogs/2025/practice/go-dependency-injection-in-action-basics-to-advanced-practices.html#十二、结语" class="sidebar-link reco-side-十二、结语" data-v-70334359>十二、结语</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.26b7b206.js" defer></script><script src="/assets/js/4.34a1f699.js" defer></script><script src="/assets/js/1.fa01cbc2.js" defer></script><script src="/assets/js/89.acc39148.js" defer></script>
  </body>
</html>
